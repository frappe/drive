import{b as $,e as Me,aH as Te,am as ze,o as s,g as d,F as A,p as P,h,c as E,aI as N,a as Z,j as T,aJ as Se,n as C,q as ge,aK as Re,w as R,k as i,ae as q,aq as le,af as se,i as M,aL as he,a3 as Q,u as ee,z as X,d as S,s as K,m as te,aM as pe,aN as W,aO as Y,aP as ye,aQ as B,aR as be,J as U,aa as Ie,$ as Ve,K as Ae,H as ie,E as O,aS as j,I as J,aT as _e,B as we,r as Ne,f as Oe,aU as ke,_ as xe,aV as H,aB as F,ab as ae,aW as Ee,ao as je,aX as Ue,T as oe,aY as Pe,X as $e,aZ as Fe,a_ as Be,a$ as re,l as Ke,b0 as He,N as We,b1 as Xe,b2 as Ge,b3 as Le,b4 as qe,b5 as Ye,b6 as Je,b7 as Ze,C as G,b8 as ue,b9 as Qe,ba as et,Y as ce,ai as tt,bb as at,bc as nt,aj as st,bd as lt,be as de,a1 as it,bf as ot,al as rt,ay as me,bg as ut,bh as ct,bi as dt,bj as mt,t as ft}from"./index-5693bb51.js";import{a as vt,b as gt,c as ht,d as pt,e as yt,f as bt,_ as _t}from"./ListView-3caa45c5.js";import{L as wt,e as kt,b as xt,c as Et,_ as $t,a as Lt}from"./ErrorPage-d33221b5.js";import{L as Ct}from"./folder-open-dot-0bae2b76.js";const ne=()=>typeof window<"u"&&!!window.document&&!!window.document.createElement;class Dt{constructor(){this.handleWheel=a=>{a.preventDefault()},this.handleScroll=()=>{window.scrollTo(...this.lockToScrollPos)},this.handleKeydown=a=>{let l=this.options.keyboardKeys;["INPUT","TEXTAREA"].includes(a.target.tagName)&&(l=l.filter(f=>!this.options.authorizedInInputs.includes(f))),l.includes(a.keyCode)&&a.preventDefault()},this.element=null,this.lockToScrollPos=[0,0],this.options={authorizedInInputs:[32,37,38,39,40],disableKeys:!0,disableScroll:!0,disableWheel:!0,keyboardKeys:[32,33,34,35,36,37,38,39,40]},ne()&&(this.element=document.scrollingElement)}on(a,l){if(!ne())return;this.element=a||this.element,this.options={...this.options,...l};const{disableKeys:f,disableScroll:o,disableWheel:c}=this.options;c&&(document.addEventListener("wheel",this.handleWheel,{passive:!1}),document.addEventListener("touchmove",this.handleWheel,{passive:!1})),o&&(this.lockToScrollPos=[this.element?.scrollLeft??0,this.element?.scrollTop??0],document.addEventListener("scroll",this.handleScroll,{passive:!1})),f&&document.addEventListener("keydown",this.handleKeydown,{passive:!1})}off(){ne()&&(document.removeEventListener("wheel",this.handleWheel),document.removeEventListener("touchmove",this.handleWheel),document.removeEventListener("scroll",this.handleScroll),document.removeEventListener("keydown",this.handleKeydown))}}const fe=new Dt,Mt=["onClick"],Tt={key:0},zt={key:1,class:"group flex h-7 w-full items-center rounded px-2 text-base hover:bg-surface-gray-3 text-ink-gray-6"},Ce={__name:"ContextMenu",props:{actionItems:Array,event:Object,close:Function},setup(n){const a=n,l=$(null),f=$(null),o=$(null),c=$(null),x=$(null);Me(()=>{f.value=window.document.body.clientWidth,o.value=window.document.body.clientHeight,c.value=l.value.clientWidth,x.value=l.value.clientHeight,g(),v(),fe.on()}),Te(()=>{g(),v()}),ze(()=>{fe.off()});function g(){return a.event.y>=o.value-x.value?l.value.style.top=a.event.y-x.value+"px":l.value.style.top=a.event.y+"px"}function v(){return a.event.x>=f.value-c.value?l.value.style.left=a.event.x-c.value+"px":l.value.style.left=a.event.x+"px"}return(p,y)=>n.actionItems.length>0?(s(),d("div",{key:0,ref_key:"contextMenu",ref:l,class:"w-[208px] p-1.5 fixed mt-2 min-w-40 rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none",style:Se({left:`${v}px`,top:`${g}px`,"z-index":1e3})},[(s(!0),d(A,null,P(n.actionItems,(_,D)=>(s(),d("div",{key:D,onClick:()=>{_.handler(),n.close()}},[_.divider?(s(),d("div",Tt,[...y[0]||(y[0]=[h("hr",{class:"my-1 bg-surface-gray-4"},null,-1)])])):(s(),d("button",zt,[(s(),E(Z(_.icon),{class:N(["mr-2 size-4 flex-shrink-0",_.theme?"text-[#E03636]":"text-ink-gray-7"])},null,8,["class"])),h("span",{class:N(["whitespace-nowrap",_.theme?"text-ink-red-4":"text-ink-gray-7"])},T(_.label),3)]))],8,Mt))),128))],4)):C("",!0)}},St=["src"],Rt=["src"],It={class:"flex flex-row grow justify-end gap-2 w-[20px]"},Vt={__name:"CustomListRowItem",props:{idx:Number,column:Object,row:Object,item:String,contextMenu:Function},setup(n){const a=n;let l,f,o,c,x;return a.column.prefix&&a.column.key==="title"&&([o,c,x]=a.column.prefix({row:a.row}),l=$(o||c),f=$(!1)),(g,v)=>{const p=he,y=ge("Button"),_=Q;return s(),E(i(vt),{column:n.column,row:n.row,item:n.item,align:n.column.align},Re({default:R(({label:D})=>[(s(),d("div",{key:D,class:"truncate text-base"},T(n.column?.getLabel?n.column.getLabel({row:n.row}):D),1)),n.column.key==="options"&&n.contextMenu?(s(),E(y,{key:0,class:"!bg-inherit",onClick:v[2]||(v[2]=r=>n.contextMenu(r,n.row))},{default:R(()=>[M(p,{class:"size-4"})]),_:1})):C("",!0)]),_:2},[n.column.key==="title"?{name:"prefix",fn:R(()=>[i(f)?C("",!0):(s(),d("img",{key:0,loading:"lazy",class:"h-[16px] w-[16px] rounded-sm",src:i(c),draggable:!1},null,8,St)),q(h("img",{class:"h-[16px] w-[16px] object-cover rounded-sm",src:i(l),draggable:!1,onError:v[0]||(v[0]=D=>le(l)?l.value=i(c):l=i(c)),onLoad:v[1]||(v[1]=D=>le(f)?f.value=!0:f=!0)},null,40,Rt),[[se,i(f)]])]),key:"0"}:void 0,n.idx===0?{name:"suffix",fn:R(()=>[h("div",It,[n.column.suffix?(s(),E(Z(n.column.suffix({row:n.row})),{key:0})):C("",!0),n.row.is_favourite&&g.$route.name!=="Favourites"?(s(),E(_,{key:1,name:"star",width:"16",height:"16",class:"my-auto stroke-amber-500 fill-amber-500"})):C("",!0)])]),key:"1"}:void 0]),1032,["column","row","item","align"])}}},ve={__name:"CustomListRow",props:{rows:Array,contextMenu:Function,selections:Set},emits:["dropped"],setup(n){const a=$(),l=ee(),f=X(),o=S(()=>K.data?.single_click?"click":"dblclick"),c=S(()=>f.state.activeEntity?.name),x=g=>l.name!=="Trash"&&W(g);return(g,v)=>(s(!0),d(A,null,P(n.rows,p=>(s(),E(i(gt),te({key:p.name,row:p,class:["group",[p.name===c.value||n.selections.has(p.name)?"bg-surface-gray-2 hover:!bg-surface-gray-3":"bg-surface-white",a.value===p.name?"opacity-60 hover:shadow-none":""]],draggable:!0,onContextmenu:y=>!n.selections.size&&n.contextMenu(y,p)},{[pe(o.value)]:y=>!n.selections.size&&x(p)},{onDragstart:y=>a.value=p.name,onDragend:v[0]||(v[0]=y=>a.value=null),onDragover:y=>p.is_group&&y.preventDefault(),onDrop:y=>g.$emit("dropped",p,a.value)}),{default:R(({idx:y,column:_,item:D})=>[M(Vt,{column:_,row:p,item:D,idx:y,"context-menu":!n.selections.size&&n.contextMenu},null,8,["column","row","item","idx","context-menu"])]),_:2},1040,["row","class","onContextmenu","onDragstart","onDragover","onDrop"]))),128))}},At={key:0,class:"w-full text-center flex items-center justify-center py-10"},Nt={key:1,class:"h-full overflow-y-auto"},Ot={key:2,class:"pb-8"},jt={__name:"ListView",props:Y({folderContents:Object,actionItems:Array,userData:Object,rootEntity:Object},{modelValue:new Set,modelModifiers:{}}),emits:Y(["dropped"],["update:modelValue"]),setup(n,{emit:a}){const l=X(),f=ee(),o=n,c=a,x=ye("container"),g=B(n,"modelValue",new Set),v=$(null),p=$(null),y=S(()=>o.folderContents?Array.isArray(o.folderContents)?o.folderContents:Object.keys(o.folderContents).map(t=>({group:t,rows:o.folderContents[t]||[],collapsed:!1})).filter(t=>t.rows.length):[]),_=[{label:__("Name"),key:"title",getLabel:({row:{title:t,is_group:m,document:I}})=>t.lastIndexOf(".")===-1||m||I?t:t.slice(0,t.lastIndexOf(".")),getTooltip:t=>t.is_group||t.document?"":t.title,prefix:({row:t})=>be(t),suffix:({row:t})=>{if(t.share_count!==o.rootEntity?.share_count){if(t.share_count===-2)return U(wt,{class:"size-4"});if(t.share_count===-1)return U(Ie,{class:"size-4"});if(t.share_count>0)return U(Ve,{class:"size-4"})}}},{label:__("Owner"),key:"",getLabel:({row:t})=>t.owner===l.state.user.id?"You":o.userData[t.owner]?.full_name||t.owner,prefix:({row:t})=>U(Ae,{shape:"circle",image:o.userData[t.owner]?.user_image,label:o.userData[t.owner]?.full_name||o.userData[t.owner]?.email||t.owner,size:"sm"}),width:"10%"},{label:__("Last Modified"),getLabel:({row:t})=>t.relativeModified,getTooltip:t=>ie(t.modified),key:"modified",isEnabled:t=>t!=="Recents",width:"15%"},{label:__("Last Accessed"),getLabel:({row:t})=>t.relativeAccessed,getTooltip:t=>ie(t.accessed),key:"modified",isEnabled:t=>t==="Recents",width:"15%"},{label:__("Size"),key:"",getLabel:({row:t})=>t.is_group?t.children?t.children+" item"+(t.children===1?"":"s"):"empty":t.file_size_pretty||"-",width:"8%"},{label:"",key:"options",align:"right",width:"5%"}].filter(t=>!t.isEnabled||t.isEnabled(f.name)),D=t=>{const m=o.folderContents.find(I=>I.name===t);v.value=!m||m.name!==l.state.activeEntity?.name?m:null};O(v,t=>{l.commit("setActiveEntity",t)});const r=t=>t?o.actionItems.filter(m=>!m.isEnabled||m.isEnabled(t)).map(m=>({...m,handler:()=>{p.value=!1,l.commit("setActiveEntity",t),m.action([t])}})):[],w=(t,m)=>{g.value.size>0||(t.ctrlKey&&W(m,!0),p.value=t,v.value=m,t.stopPropagation(),t.preventDefault())},k=t=>{g.value=t,v.value=null,l.commit("setActiveEntity",null)};return j("a",t=>{t.target.classList.contains("ProseMirror")||t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||t.metaKey&&(x.value.selections.clear(),o.folderContents.map(m=>x.value.selections.add(m.name)),t.preventDefault())}),j("Backspace",t=>{t.target.classList.contains("ProseMirror")||t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||t.metaKey&&J.emit("remove")}),j("m",t=>{t.target.classList.contains("ProseMirror")||t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||t.ctrlKey&&J.emit("move")}),j("Escape",t=>{t.target.classList.contains("ProseMirror")||t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||(x.value.selections.clear(),t.preventDefault())}),(t,m)=>{const I=_e("on-outside-click");return s(),d(A,null,[M(i(_t),{ref_key:"container",ref:x,class:"relative select-none p-5 md:pb-15","row-key":"name",columns:i(_),rows:y.value,options:{selectable:!0,enableActive:!0,showTooltip:!0,resizeColumn:!1,getRowRoute:()=>"",emptyState:{description:"Nothing found - try something else?"}},"onUpdate:selections":k,"onUpdate:activeRow":D},{default:R(()=>[M(i(ht),{class:"mb-[1px]"}),n.folderContents?(s(),d("div",Nt,[y.value.length?y.value[0].group?(s(!0),d(A,{key:1},P(y.value,b=>(s(),d("div",{key:b.group},[M(i(yt),{group:b},{default:R(()=>[t.$slots["group-header"]?Ne(t.$slots,"group-header",te({key:0,ref_for:!0},{group:b})):C("",!0)]),_:2},1032,["group"]),M(i(bt),{group:b},{default:R(()=>[M(ve,{rows:b.rows,"context-menu":w,selections:g.value,onDropped:m[0]||(m[0]=z=>c("dropped"))},null,8,["rows","selections"])]),_:2},1032,["group"])]))),128)):(s(),d("div",Ot,[M(ve,{rows:y.value,"context-menu":w,selections:g.value,onDropped:m[1]||(m[1]=(...b)=>t.$emit("dropped",...b))},null,8,["rows","selections"])])):(s(),E(i(pt),{key:0}))])):(s(),d("div",At,[M(i(we),{class:"w-8"})]))]),_:3},8,["columns","rows"]),p.value&&v.value?q((s(),E(Ce,{key:v.value.name,close:()=>p.value=!1,"action-items":r(v.value),event:p.value},null,8,["close","action-items","event"])),[[I,()=>p.value=!1]]):C("",!0)],64)}}},Ut={class:"h-[65%] flex items-center justify-center rounded-t-[calc(theme(borderRadius.lg)-1px)] overflow-hidden"},Pt=["src"],Ft=["src"],Bt={key:1,class:"overflow-hidden text-ellipsis whitespace-nowrap h-full w-[calc(100%-1rem)] object-cover rounded-t-[calc(theme(borderRadius.lg)-1px)] py-2"},Kt=["innerHTML"],Ht={class:"p-2 h-[35%] border-t border-gray-100 flex flex-col justify-evenly"},Wt={class:"truncate w-full w-fit text-base font-medium text-ink-gray-8"},Xt={class:"mt-[5px] text-xs text-ink-gray-5"},Gt={class:"flex items-center justify-start gap-1"},qt=["src"],Yt={class:"truncate"},Jt={__name:"GridItem",props:{file:Object},setup(n){const a=n,[l,f,o]=be(a.file),c=$(l||f),x=$(!1);let g;o||(g=Oe({url:l,cache:["thumbnail",a.file.name],auto:!0}));const v=S(()=>a.file.children?a.file.children+" item"+(a.file.children===1?"":"s"):"Empty");return(p,y)=>(s(),d(A,null,[h("div",Ut,[i(o)||!i(g)?.data?(s(),d(A,{key:0},[q(h("img",{loading:"lazy",class:N("h-10 w-auto"),src:i(f),draggable:!1},null,8,Pt),[[se,!x.value]]),q(h("img",{class:N(c.value===i(f)?"h-10 w-auto":"h-full min-w-full object-cover rounded-t-[calc(theme(borderRadius.lg)-1px)]"),src:c.value,draggable:!1,onLoad:y[0]||(y[0]=_=>x.value=!0)},null,42,Ft),[[se,x.value]])],64)):(s(),d("div",Bt,[h("div",{class:"prose prose-sm pointer-events-none scale-[.39] ml-0 origin-top-left",innerHTML:i(g).data},null,8,Kt)]))]),h("div",Ht,[h("div",Wt,T(n.file.title),1),h("div",Xt,[h("div",Gt,[n.file.file_type!=="Unknown"&&!n.file.is_group&&(x.value&&c.value!==i(f)||!i(o))?(s(),d("img",{key:0,loading:"lazy",class:"h-4 w-auto",src:i(ke)(n.file.file_type)||"/drive",draggable:!1},null,8,qt)):C("",!0),h("p",Yt,T(n.file.is_group?v.value+"∙":"")+" "+T(n.file.file_type!=="Unknown"?n.file.file_type+"∙":"")+" "+T(n.file.relativeModified),1)])])])],64))}};const Zt={key:0,class:"grid-container gap-5 p-5 pb-[60px] overflow-auto select-none"},Qt=["id","onDragstart","onDragover","onDrop","onClick","onContextmenu"],ea={__name:"GridView",props:Y({folderContents:Object,actionItems:Array,userData:Object},{modelValue:new Set,modelModifiers:{}}),emits:Y(["dropped"],["update:modelValue"]),setup(n){const a=n,l=ee(),f=X(),o=B(n,"modelValue",new Set),c=S(()=>a.folderContents),x=(K.data?.message||K.data)?.single_click?"click":"dblclick",g=$(null),v=$(null),p=(r,w)=>{o.value.size>0||(r.ctrlKey&&W(w,!0),v.value=r,g.value=w,r.stopPropagation(),r.preventDefault())},y=r=>r?a.actionItems.filter(w=>!w.isEnabled||w.isEnabled(r)).map(w=>({...w,handler:()=>{v.value=!1,f.commit("setActiveEntity",r),w.action([r])}})):[],_=r=>!o.value.size&&l.name!=="Trash"&&W(r),D=$(null);return j("a",r=>{r.target.classList.contains("ProseMirror")||r.target.tagName==="INPUT"||r.target.tagName==="TEXTAREA"||r.metaKey&&(o.value=new Set(a.folderContents.map(w=>w.name)),r.preventDefault())}),j("Backspace",r=>{r.target.classList.contains("ProseMirror")||r.target.tagName==="INPUT"||r.target.tagName==="TEXTAREA"||r.metaKey&&J.emit("remove")}),j("m",r=>{r.target.classList.contains("ProseMirror")||r.target.tagName==="INPUT"||r.target.tagName==="TEXTAREA"||r.ctrlKey&&J.emit("move")}),j("Escape",r=>{r.target.classList.contains("ProseMirror")||r.target.tagName==="INPUT"||r.target.tagName==="TEXTAREA"||(o.value=new Set,r.preventDefault())}),(r,w)=>{const k=Q,t=he,m=Ce,I=_e("on-outside-click");return s(),d(A,null,[c.value?.length?(s(),d("div",Zt,[(s(!0),d(A,null,P(c.value,b=>(s(),d("div",te({id:b.name,key:b.name,class:["grid-item rounded-lg group select-none entity cursor-pointer relative h-[172px] border bg-surface-white",[o.value.has(b.name)||g.value?.name===b.name?"bg-surface-gray-2 shadow-gray":"border-outline-gray-modals hover:shadow-lg",D.value===b.name?"opacity-60 hover:shadow-none":""]],draggable:!0,onDragstart:z=>D.value=b.name,onDragend:w[0]||(w[0]=z=>D.value=null),onDragover:z=>b.is_group&&z.preventDefault(),onDrop:z=>r.$emit("dropped",b,D.value),onClick:H(z=>o.value.has(b.name)?o.value.delete(b.name):o.value.add(b.name),["meta"])},{[pe(i(x))]:z=>_(b)},{onContextmenu:z=>p(z,b),onMousedown:w[1]||(w[1]=H(()=>{},["stop"]))}),[r.$route.name!=="Favourites"&&b.is_favourite?(s(),E(k,{key:0,class:"stroke-amber-500 fill-amber-500 absolute top-2 left-2 h-4",width:"16",height:"16"})):C("",!0),M(i(F),{variant:"subtle",class:N(["duration-300 absolute top-2 right-2",[o.value.size>0?"":"!bg-surface-gray-3 hover:shadow-lg",g.value?.name===b.name?"":"invisible group-hover:visible"]]),onClick:H(z=>p(z,b),["stop"])},{default:R(()=>[M(t,{class:"size-4"})]),_:1},8,["class","onClick"]),M(Jt,{file:b},null,8,["file"])],16,Qt))),128))])):C("",!0),v.value&&g.value?q((s(),E(m,{key:g.value.name,close:()=>(v.value=!1,g.value=null),"action-items":y(g.value),event:v.value},null,8,["close","action-items","event"])),[[I,()=>(v.value=!1,g.value=null)]]):C("",!0)],64)}}},ta=xe(ea,[["__scopeId","data-v-48624440"]]),aa={class:"lucide lucide-sparkles",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function na(n,a){return s(),d("svg",aa,[...a[0]||(a[0]=[h("path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z"},null,-1),h("path",{d:"M20 2v4"},null,-1),h("path",{d:"M22 4h-4"},null,-1),h("circle",{cx:"4",cy:"20",r:"2"},null,-1)])])}const sa=ae({name:"lucide-sparkles",render:na}),la={class:"lucide lucide-arrow-up-z-a",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function ia(n,a){return s(),d("svg",la,[...a[0]||(a[0]=[Ee('<path d="m3 8 4-4 4 4"></path><path d="M7 4v16"></path><path d="M15 4h5l-5 6h5"></path><path d="M15 20v-3.5a2.5 2.5 0 0 1 5 0V20"></path><path d="M20 18h-5"></path>',5)])])}const oa=ae({name:"lucide-arrow-up-za",render:ia}),ra={class:"lucide lucide-arrow-down-a-z",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function ua(n,a){return s(),d("svg",ra,[...a[0]||(a[0]=[Ee('<path d="m3 16 4 4 4-4"></path><path d="M7 20V4"></path><path d="M20 8h-5"></path><path d="M15 10V6.5a2.5 2.5 0 0 1 5 0V10"></path><path d="M15 14h5l-5 6h5"></path>',5)])])}const ca=ae({name:"lucide-arrow-down-az",render:ua}),da={class:"flex p-5 pb-0 h-12"},ma={key:0,class:"my-auto w-[40%] text-base text-ink-gray-8"},fa={key:1,class:"bg-surface-gray-2 rounded-[10px] space-x-0.5 h-7 flex items-center px-0.5 mr-4 py-1"},va={class:"flex gap-2 ml-auto my-auto"},ga={key:0,class:"flex flex-wrap items-start justify-end gap-1 ml-3"},ha={class:"flex items-center border rounded pl-2 py-1 h-7 text-base select-none"},pa=["src"],ya={class:"text-sm ml-2"},ba={class:"flex items-center whitespace-nowrap"},_a={class:"flex items-center gap-2"},wa={key:1,class:"flex gap-3 ml-4 overflow-auto"},ka={__name:"DriveToolBar",props:Y({selections:Array,actionItems:Array,getEntities:Object},{sortOrder:{},sortOrderModifiers:{},search:{},searchModifiers:{},team:{},teamModifiers:{},filters:{},filtersModifiers:{}}),emits:["update:sortOrder","update:search","update:team","update:filters"],setup(n){const a=B(n,"sortOrder"),l=B(n,"search"),f=B(n,"team"),o=n,c=X(),x=B(n,"filters"),g=S(()=>!o.getEntities.data?.length),v=$(c.state.view);O(v,k=>c.commit("toggleView",k));const p=$(c.state.shareView),y=ye("search-input"),_=S(()=>{if(!o.getEntities.data)return[];const k=new Set(o.getEntities.data.map(t=>t.file_type));return o.getEntities.data.find(t=>t.is_group)&&k.add("Folder"),Array.from(k).sort((t,m)=>t>m?1:-1).map(t=>({name:t,icon:ke(t)}))});j("Escape",()=>{y.value.el.blur(),l.value=""});const D=S(()=>w.map(k=>({...k,onClick:()=>{a.value.field=k.field,a.value.label=k.label}}))),r=()=>{a.value.ascending=!a.value.ascending},w=[{label:__("Name"),field:"title"},{label:__("Owner"),field:"owner"},{label:__("Modified"),field:"modified"},{label:__("Size"),field:"file_size"},{label:__("Type"),field:"mime_type"},{group:!0,hideLabel:!0,items:[{component:je({setup(){return()=>U(Ue,{label:__("Smart"),disabled:a.value.field!=="title",modelValue:a.value.smart,"onUpdate:modelValue":k=>a.value.smart=k})}})}]}];return(k,t)=>{const m=He,I=ca,b=oa,z=sa;return s(),d("div",da,[n.selections?.length?(s(),d("div",ma,T(n.selections.length)+" "+T(n.selections.length===1?k.__("item"):k.__("items"))+" "+T(k.__("selected")),1)):k.$route.name==="Shared"?(s(),d("div",fa,[M(i(oe),{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),buttons:[{label:k.__("By"),value:"by",onClick:()=>{i(c).commit("toggleShareView","by")}},{label:k.__("With you"),value:"with",onClick:()=>{i(c).commit("toggleShareView","with")}}]},null,8,["modelValue","buttons"])])):C("",!0),M(i(Pe),{ref:"search-input",modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value=e),disabled:g.value,class:N([n.selections.length?"hidden":"block","w-[30%]"]),placeholder:k.__("Find")},{prefix:R(()=>[M(m,{class:"size-4"})]),_:1},8,["modelValue","disabled","class","placeholder"]),h("div",va,[n.selections?.length?n.actionItems?(s(),d("div",wa,[(s(!0),d(A,null,P(n.actionItems.filter(e=>e.important&&(n.selections.length===1||e.multi)).filter(e=>!e.isEnabled||n.selections.every(u=>e.isEnabled(u,n.selections.length!==1))),e=>(s(),E(i(F),{key:e.label,variant:"outline",tooltip:e.label,size:"md",onClickOnce:u=>e.action(n.selections)},{icon:R(()=>[(s(),E(Z(e.icon),{class:N(["size-4 text-ink-gray-6",[e.class,e.theme?"text-ink-red-3":""]])},null,8,["class"]))]),_:2},1032,["tooltip","onClickOnce"]))),128))])):C("",!0):(s(),d(A,{key:0},[x.value.length?(s(),d("div",ga,[(s(!0),d(A,null,P(x.value,({icon:e,name:u},L)=>(s(),d("div",{key:L},[h("div",ha,[h("img",{src:e},null,8,pa),h("span",ya,T(u),1),M(i(F),{variant:"minimal",icon:U(i($e),{class:"size-3"}),onClick:V=>x.value.splice(L,1)},null,8,["icon","onClick"])])]))),128))])):C("",!0),n.getEntities.loading?(s(),E(i(F),{key:1,loading:!0,label:"Loading..."})):C("",!0),["Shared","Recents","Favourites","Trash"].includes(k.$route.name)?(s(),E(Fe,{key:2,modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e),none:!0},null,8,["modelValue"])):C("",!0),M(i(re),{options:_.value.map(({name:e,icon:u})=>({label:k.__(e),icon:U("img",{src:u}),onClick:()=>x.value.push({name:e,icon:u}),disabled:x.value.includes({name:e,icon:u})})),button:{icon:i(Be),tooltip:"Filter"},disabled:g.value,placement:"right"},null,8,["options","button","disabled"]),k.$route.name!=="Recents"?(s(),E(i(re),{key:3,options:D.value,placement:"right"},{default:R(()=>[h("div",ba,[M(i(F),{class:"text-sm h-7 border-r border-slate-200 rounded-r-none",disabled:g.value,onClick:H(r,["stop"])},{icon:R(()=>[a.value.ascending?(s(),E(I,{key:0,class:"size-4"})):(s(),E(b,{key:1,class:"size-4"}))]),_:1},8,["disabled"]),M(i(F),{class:"text-sm h-7 rounded-l-none flex-1",disabled:g.value},{default:R(()=>[h("div",_a,[Ke(T(k.__(a.value.label))+" ",1),a.value.smart?(s(),E(z,{key:0,class:"size-3"})):C("",!0)])]),_:1},8,["disabled"])])]),_:1},8,["options"])):C("",!0),M(i(oe),{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=e=>v.value=e),buttons:[{icon:"grid",value:"grid",disabled:g.value},{icon:"list",value:"list",disabled:g.value}]},null,8,["modelValue","buttons"])],64))])])}}},xa={class:"flex flex-col items-center m-auto gap-4",style:{transform:"translate(0, -88.5px)"}},Ea={class:"flex flex-col items-center gap-2"},$a={key:0},La={class:"text-base text-ink-gray-6 font-medium"},Ca={class:"text-sm text-ink-gray-5"},Da={__name:"NoFilesSection",props:{icon:{type:Object,default:null},title:{type:String,default:"Nothing here"},description:{type:String,default:""},button:{type:Object,required:!1}},setup(n){return(a,l)=>(s(),d("div",xa,[h("div",Ea,[n.icon?(s(),d("div",$a,[(s(),E(Z(n.icon),{class:"size-10 text-ink-gray-5"}))])):C("",!0),h("p",La,T(a.__(n.title)),1)]),h("p",Ca,T(a.__(n.description)),1)]))}},Ma={name:"ProgressRing",props:{progress:{type:Number,required:!0},radius:{type:Number,default:24},stroke:{type:Number,default:4},primaryClass:{type:String,default:"text-black"},secondaryClass:{type:String,default:"text-ink-gray-1"}},computed:{normalizedRadius(){return this.radius-this.stroke},circumference(){return this.normalizedRadius*2*Math.PI},strokeDashoffset(){return this.circumference-this.progress/100*this.circumference}}},Ta=["height","width"],za=["cx","cy","r","stroke-width","stroke-dasharray"],Sa=["cx","cy","r","stroke-width","stroke-dasharray","stroke-dashoffset"];function Ra(n,a,l,f,o,c){return s(),d("svg",{height:l.radius*2,width:l.radius*2},[h("circle",{class:N(["fill-transparent stroke-current",l.secondaryClass]),cx:l.radius,cy:l.radius,r:c.normalizedRadius,"stroke-width":l.stroke,"stroke-dasharray":c.circumference},null,10,za),h("circle",{class:N(["fill-transparent stroke-current origin-center -rotate-90 transition-all",l.primaryClass]),cx:l.radius,cy:l.radius,r:c.normalizedRadius,"stroke-width":l.stroke,"stroke-dasharray":c.circumference,"stroke-dashoffset":c.strokeDashoffset},null,10,Sa)],8,Ta)}const Ia=xe(Ma,[["render",Ra]]),Va={class:"text-ink-gray-8 flex flex-col items-start fixed bottom-0 right-0 m-5 w-96 z-1 rounded-2xl overflow-hidden shadow-2xl dark:border 500 bg-surface-white p-4"},Aa={key:0,class:"font-medium truncate text-lg"},Na={key:1,class:"font-medium truncate text-lg"},Oa={key:2,class:"font-medium truncate text-lg"},ja={class:"ml-auto flex items-center gap-4"},Ua={key:0,class:"max-h-64 overflow-y-auto bg-surface-white w-full"},Pa=["onMouseover"],Fa=["onClick"],Ba={class:"flex items-center justify-between w-full"},Ka={class:"flex justify-start items-center w-full max-w-[80%]"},Ha={class:"truncate text-sm leading-6 col-span-1 row-span-1"},Wa={__name:"UploadTracker",setup(n){const a=$(!1),l=$(!1),f=$(null),o=$(null),c=X(),x=We(),g=()=>_.value.concat(p.value,y.value),v=()=>Object.fromEntries(Object.keys(c.getters).map(r=>[r,S(()=>c.getters[r])])),{uploadsInProgress:p,uploadsCompleted:y,uploadsFailed:_}=v(),D=r=>{o.value=r,r.error&&(l.value=!0),r.completed&&r.response&&x.push({name:"File",params:{entityName:r.response.name}})};return(r,w)=>{const k=Je,t=ge("Button");return s(),d("div",Va,[h("div",{class:N(["flex items-center justify-between w-full pr-1.5",[a.value?"cursor-pointer":"mb-4"]]),onClick:w[2]||(w[2]=m=>a.value=!1)},[i(p).length>0?(s(),d("div",Aa," Uploading "+T(i(p).length)+" "+T(i(p).length==1?"file":"files"),1)):i(y).length>0?(s(),d("div",Na,T(i(y).length)+" "+T(i(y).length==1?"file":"files")+" uploaded ",1)):i(_).length>0?(s(),d("div",Oa,T(i(_).length)+" "+T(i(_).length==1?"upload":"uploads")+" failed ",1)):C("",!0),h("div",ja,[h("button",{class:"focus:outline-none",onClick:w[0]||(w[0]=H(m=>a.value=!a.value,["stop"]))},[(s(),E(Z(a.value?i(Xe):i(Ge)),{class:"size-4 text-ink-gray-8"}))]),h("button",{class:"focus:outline-none",onClick:w[1]||(w[1]=m=>i(c).commit("clearUploads"))},[M(i($e),{class:"size-4 text-ink-gray-8"})])])],2),a.value?C("",!0):(s(),d("div",Ua,[(s(!0),d(A,null,P(g(),(m,I)=>(s(),d("div",{key:m.uuid,class:"cursor-pointer truncate hover:bg-surface-menu-bar rounded px-1 group",onMouseover:b=>f.value=I,onMouseout:w[3]||(w[3]=b=>f.value=null)},[h("div",{class:"flex items-center gap-3 py-1 pr-[3px]",onClick:b=>D(m)},[h("div",Ba,[h("div",Ka,[M(k,{class:"size-4 mr-2"}),h("p",Ha,T(m.name),1)]),m.completed?(s(),E(t,{key:0,variant:"ghost",icon:m.error?i(Le):i(Ct)},null,8,["icon"])):C("",!0),!m.completed&&!m.error?(s(),E(Ia,{key:1,radius:13,progress:Math.min(m.progress,98)},null,8,["progress"])):C("",!0),m.error?(s(),E(t,{key:2,variant:"ghost",icon:i(qe),class:"rounded-full hover:bg-surface-gray-2",onClick:H(b=>r.emitter.emit("retryUpload",m.uuid),["stop"])},null,8,["icon","onClick"])):C("",!0)])],8,Fa)],40,Pa))),128))])),l.value?(s(),E(i(Ye),{key:1,modelValue:l.value,"onUpdate:modelValue":w[4]||(w[4]=m=>l.value=m),options:{title:"Upload failed",message:o.value.error,size:"sm",actions:[{label:"OK",variant:"solid",onClick:()=>{l.value=!1}}]}},null,8,["modelValue","options"])):C("",!0)])}}},Xa={class:"lucide lucide-link-2",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function Ga(n,a){return s(),d("svg",Xa,[...a[0]||(a[0]=[h("path",{d:"M9 17H7A5 5 0 0 1 7 7h2"},null,-1),h("path",{d:"M15 7h2a5 5 0 1 1 0 10h-2"},null,-1),h("line",{x1:"8",x2:"16",y1:"12",y2:"12"},null,-1)])])}const qa=ae({name:"lucide-link-2",render:Ga});const Ya={key:2,id:"drop-area",ref:"container",class:"flex flex-col overflow-auto min-h-full bg-surface-white"},Ja={key:0,class:"m-auto",style:{transform:"translate(0, -88.5px)"}},an={__name:"GenericPage",props:{grouper:{type:Function,default:n=>n},showSort:{type:Boolean,default:!0},verify:{type:Object,default:null},icon:[Function,Object],empty:Object,getEntities:Object},setup(n){const a=n,l=ee(),f=X(),o=$("");Ze("dialog",o);const c=$(["Shared","Recents","Favourites","Trash"].includes(l.name)?"all":l.params.team);O(()=>l.params.team,e=>{e&&(c.value=e),G.fetch({team:e})});const x=S(()=>f.state.activeEntity),g=S(()=>a.getEntities.params?.entity_name||a.getEntities.params?.personal),v=$(f.state.sortOrder[g.value]||{label:"Modified",field:"modified",ascending:!1}),p=$(""),y=$([]),_=$(a.getEntities.data);O(g,e=>{f.state.sortOrder[e]&&(v.value=f.state.sortOrder[e])}),O(v,e=>{_.value=ue([..._.value],e),a.getEntities.setData(_.value),g.value&&f.commit("setSortOrder",[g.value,e])},{deep:!0}),O(p,e=>{const u=new RegExp(e,"i");_.value=a.getEntities.data.filter(L=>u.test(L.title))}),O(()=>y.value,e=>{if(!e.length){_.value=a.getEntities.data;return}const u=e.map(V=>V.name),L=u.find(V=>V==="Folder");_.value=a.getEntities.data.filter(({file_type:V,is_group:De})=>u.includes(V)||L&&De)},{deep:!0}),O(()=>a.getEntities.data,e=>{e&&(_.value=ue([...e],v.value),f.commit("setCurrentFolder",{entities:_.value.filter?.(u=>u.title[0]!==".")}))},{immediate:!0,deep:!0}),f.commit("setListResource",a.getEntities),f.commit("setCurrentResource",null);const D=$(new Set),r=S(()=>a.getEntities.data?.filter?.(({name:e})=>D.value.has(e))||[]),w=S(()=>a.verify?.data||!a.verify);Qe(()=>{w.value?.write&&ct("paste",dt)});const k=()=>{const e={team:c.value==="home"?"":c.value||""};v.value&&(e.order_by=v.value.field+(v.value.ascending?" 1":" 0")),a.getEntities.fetch({...a.getEntities.params,...e})};O([w,c],([e])=>{e&&k()},{immediate:!0,deep:!1}),J.on("refresh",k),c.value&&!G.fetched&&f.getters.isLoggedIn&&G.fetch({team:c.value}),!K.fetched&&f.getters.isLoggedIn&&K.fetch();const t=(e,u)=>{if(!e.is_group||u===e.name||!u)return;mt.submit({entity_names:[u],new_parent:e.name});const L=a.getEntities.data.findIndex(V=>V.name===u);a.getEntities.data.splice(L,1),a.getEntities.data.find(V=>V.name===e.name).children+=1,a.getEntities.setData(data)},m=S(()=>l.name==="Trash"?[{label:"Restore",icon:et,action:()=>o.value="restore",multi:!0,important:!0},{label:"Delete forever",icon:ce,action:()=>o.value="d",isEnabled:()=>l.name==="Trash",multi:!0,danger:!0}].filter(e=>!e.isEnabled||e.isEnabled()):[{label:__("Preview"),icon:tt,action:([e])=>W(e),isEnabled:e=>!e.is_link},{label:__("Open"),icon:at,action:([e])=>W(e),isEnabled:e=>e.is_link},{divider:!0},{label:__("Share"),icon:nt,action:()=>o.value="s",isEnabled:e=>e.share,important:!0},{label:__("Download"),icon:st,isEnabled:e=>!e.is_link&&e.mime_type!=="frappe/slides"&&e.allow_download,action:e=>kt(c.value,e),multi:!0,important:!0},{label:__("Copy Link"),icon:qa,action:([e])=>lt(e),important:!0},{divider:!0,isEnabled:e=>!e.external},{label:__("Move"),icon:xt,action:()=>o.value="m",isEnabled:e=>e.write,multi:!0,important:!0},{label:__("Rename"),icon:Et,action:()=>o.value="rn",isEnabled:e=>e.write},{label:__("Show Info"),icon:Le,action:()=>o.value="i",isEnabled:e=>!f.state.activeEntity||!f.state.showInfo&&!e.external},{label:__("Favourite"),icon:Q,action:e=>{e.forEach(u=>u.is_favourite=!0),a.getEntities.setData(a.getEntities.data),de.submit({entities:e})},isEnabled:e=>!e.is_favourite&&!e.external,important:!0,multi:!0},{label:__("Unfavourite"),icon:Q,class:"stroke-amber-500 fill-amber-500",action:e=>{e.forEach(u=>u.is_favourite=!1),a.getEntities.setData(a.getEntities.data),de.submit({entities:e})},isEnabled:e=>e.is_favourite&&!e.external,important:!0,multi:!0},{label:__("Remove from Recents"),icon:it,action:e=>{ot.submit({entities:e})},isEnabled:()=>l.name=="Recents",important:!0,multi:!0},{divider:!0,isEnabled:e=>e.write},{label:__("Delete"),icon:ce,action:()=>o.value="remove",isEnabled:e=>e.write,important:!0,multi:!0,theme:"red"}]),I=S(()=>G.data?Object.fromEntries(G.data.map(e=>[e.name,e])):{});async function b(){if(document.hasFocus())try{const e=await navigator.clipboard.readText();if(localStorage.getItem("prevClip")===e)return;localStorage.setItem("prevClip",e),new URL(e).host&&ft({title:"Link detected",text:e,buttons:[{label:"Add",onClick:()=>{o.value="l"}}]})}catch{}}K.data?.auto_detect_links&&(b(),window.addEventListener("focus",b),window.addEventListener("copy",b));const z=rt("socket");return z.on("list-add",({file:e})=>{e.parent_entity===a.getEntities.params.entity_name&&!a.getEntities.data.find(u=>u.name===e.name)&&(a.getEntities.data.push(...me([e])),a.getEntities.setData(a.getEntities.data))}),z.on("list-update",({file:e})=>{if(e.parent_entity!==a.getEntities.params.entity_name)return;const u=a.getEntities.data.findIndex(L=>L.name==e.name);u!==-1&&a.getEntities.data.splice(u,1,...me([e])),a.getEntities.setData(a.getEntities.data)}),z.on("list-remove",({parent:e,entity_name:u})=>{if(e!==a.getEntities.params.entity_name)return;const L=a.getEntities.data.findIndex(V=>V.name==u);L!==-1&&a.getEntities.data.splice(L,1),a.getEntities.setData(a.getEntities.data)}),z.on("client-rename",({entity_name:e,title:u})=>{const L=a.getEntities.data.find(V=>V.name===e);L.title=u}),(e,u)=>(s(),d(A,null,[!n.verify?.error&&!n.getEntities.error?(s(),E($t,{key:0,"root-resource":n.verify,entities:x.value?[x.value]:r.value},null,8,["root-resource","entities"])):C("",!0),n.verify?.error||n.getEntities.error?(s(),E(Lt,{key:1,error:n.verify?.error||n.getEntities.error},null,8,["error"])):(s(),d("div",Ya,[M(ka,{"sort-order":v.value,"onUpdate:sortOrder":u[0]||(u[0]=L=>v.value=L),search:p.value,"onUpdate:search":u[1]||(u[1]=L=>p.value=L),filters:y.value,"onUpdate:filters":u[2]||(u[2]=L=>y.value=L),team:c.value,"onUpdate:team":u[3]||(u[3]=L=>c.value=L),"action-items":m.value,selections:r.value,"get-entities":n.getEntities||{data:[]}},null,8,["sort-order","search","filters","team","action-items","selections","get-entities"]),a.getEntities.data?a.getEntities.data?.length?e.$store.state.view==="list"?(s(),E(jt,{key:2,modelValue:D.value,"onUpdate:modelValue":u[4]||(u[4]=L=>D.value=L),"folder-contents":_.value&&n.grouper(_.value),"action-items":m.value,"user-data":I.value,"root-entity":n.verify?.data,onDropped:t},null,8,["modelValue","folder-contents","action-items","user-data","root-entity"])):(s(),E(ta,{key:3,modelValue:D.value,"onUpdate:modelValue":u[5]||(u[5]=L=>D.value=L),"folder-contents":_.value,"action-items":m.value,"user-data":I.value,onDropped:t},null,8,["modelValue","folder-contents","action-items","user-data"])):(s(),E(Da,te({key:1,icon:n.icon},n.empty),null,16,["icon"])):(s(),d("div",Ja,[M(i(we),{class:"size-5 text-ink-gray-9"})]))],512)),u[6]||(u[6]=h("p",{class:"hidden absolute text-center top-1/2 left-[calc(50%-4rem)] w-32 z-10 font-bold"}," Drop to upload ",-1)),i(f).state.uploads.length>0?(s(),E(ut,{key:3,"enter-active-class":"transition duration-[150ms] ease-[cubic-bezier(.21,1.02,.73,1)]","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-[150ms] ease-[cubic-bezier(.21,1.02,.73,1)]","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:R(()=>[M(Wa)]),_:1})):C("",!0)],64))}};export{an as _};
//# sourceMappingURL=GenericPage-c76ef58c.js.map
