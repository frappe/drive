{"version":3,"file":"LoginSignup-70096425.js","sources":["../../../../frontend/node_modules/frappe-ui/src/components/Link.vue","../../../../frontend/src/pages/LoginSignup.vue"],"sourcesContent":["<template>\n  <component\n    :is=\"isExternal ? 'a' : 'router-link'\"\n    v-bind=\"attributes\"\n    class=\"cursor-pointer text-blue-500 hover:text-blue-600\"\n  >\n    <slot></slot>\n  </component>\n</template>\n\n<script>\nexport default {\n  props: ['to'],\n  computed: {\n    attributes() {\n      return {\n        ...this.$attrs,\n        target: this.isExternal ? '_blank' : null,\n        to: !this.isExternal ? this.to : undefined,\n        href: this.isExternal ? this.to : undefined,\n      }\n    },\n    isExternal() {\n      return this.to.startsWith('http')\n    },\n  },\n}\n</script>\n","<template>\n  <div class=\"flex h-screen w-full overflow-hidden sm:bg-surface-menu-bar\">\n    <div class=\"w-full overflow-auto\">\n      <div class=\"relative h-full\">\n        <div class=\"relative z-10 mx-auto pt-8 sm:w-max sm:pt-20\">\n          <div class=\"flex flex-col items-center\">\n            <FrappeDriveLogo class=\"inline-block h-12 w-12 rounded-md\" />\n          </div>\n          <div\n            class=\"mx-auto w-full bg-surface-white px-4 p-8 sm:mt-6 sm:w-112 sm:rounded-2xl sm:px-6 py-6 sm:shadow-2xl\"\n          >\n            <div class=\"mb-7.5 text-center\">\n              <p class=\"mb-2 text-2xl font-semibold leading-6 text-ink-gray-9\">\n                {{\n                  isLogin\n                    ? \"Login to Drive\"\n                    : params.get(\"t\")\n                      ? \"Join \" + params.get(\"t\")\n                      : \"Create a new account\"\n                }}\n              </p>\n              <p\n                class=\"break-words text-base font-normal leading-[21px] text-ink-gray-7\"\n              >\n                {{\n                  !isLogin\n                    ? params.get(\"t\")\n                      ? \"Powered by Frappe Drive.\"\n                      : \"Get 5 GB for free, no credit card required.\"\n                    : \"Welcome back!\"\n                }}\n              </p>\n            </div>\n\n            <form class=\"flex flex-col\">\n              <FormControl\n                v-model=\"email\"\n                label=\"Email\"\n                type=\"email\"\n                placeholder=\"johndoe@mail.com\"\n                autocomplete=\"email\"\n                :disabled=\"otpRequested\"\n                required\n              />\n              <template v-if=\"otpValidated && !isLogin\">\n                <div class=\"mt-5 flex flex-row gap-5\">\n                  <FormControl\n                    v-model=\"first_name\"\n                    label=\"First Name\"\n                    type=\"text\"\n                    placeholder=\"Robin\"\n                    variant=\"outline\"\n                    required\n                  />\n                  <FormControl\n                    v-model=\"last_name\"\n                    label=\"Last Name\"\n                    type=\"text\"\n                    placeholder=\"Hood\"\n                    variant=\"outline\"\n                  />\n                </div>\n                <div class=\"!mt-6 flex gap-2\">\n                  <FormControl\n                    v-model=\"terms_accepted\"\n                    type=\"checkbox\"\n                  />\n                  <label class=\"text-base\">\n                    I accept the\n                    <Link\n                      class=\"!text-ink-gray-7\"\n                      to=\"https://frappecloud.com/policies\"\n                      target=\"_blank\"\n                    >\n                      Terms and Policies\n                    </Link>\n                  </label>\n                </div>\n                <div class=\"mt-8 flex flex-col items-center gap-3\">\n                  <Button\n                    :loading=\"signup.loading\"\n                    :disabled=\"!first_name.length || !terms_accepted\"\n                    variant=\"solid\"\n                    class=\"w-full font-medium\"\n                    @click=\"signup.submit()\"\n                  >\n                    Create Account\n                  </Button>\n                </div>\n              </template>\n              <div v-else-if=\"otpRequested\">\n                <FormControl\n                  v-model=\"otp\"\n                  label=\"Verification code\"\n                  type=\"text\"\n                  class=\"mt-4\"\n                  placeholder=\"123456\"\n                  :disabled=\"verifyOTP.loading\"\n                  maxlength=\"6\"\n                  required\n                  @keyup=\"\n                    (e) =>\n                      e.target.value.length === 6 &&\n                      verifyOTP.submit({\n                        account_request,\n                        otp,\n                      })\n                  \"\n                />\n                <ErrorMessage\n                  class=\"mt-4 text-center\"\n                  :message=\"verifyOTP.error\"\n                />\n                <Button\n                  class=\"mt-4 w-full\"\n                  variant=\"solid\"\n                  :loading=\"verifyOTP.loading\"\n                  @click=\"\n                    verifyOTP.submit({\n                      account_request,\n                      otp,\n                    })\n                  \"\n                >\n                  Verify\n                </Button>\n                <Button\n                  class=\"mt-2 w-full\"\n                  variant=\"outline\"\n                  :loading=\"sendOTP.loading\"\n                  :disabled=\"otpResendCountdown > 0\"\n                  @click=\"sendOTP.submit()\"\n                >\n                  Resend verification code\n                  {{\n                    otpResendCountdown > 0\n                      ? `in ${otpResendCountdown} seconds`\n                      : \"\"\n                  }}\n                </Button>\n              </div>\n              <template v-else>\n                <Button\n                  class=\"mt-4\"\n                  :loading=\"sendOTP.loading\"\n                  variant=\"solid\"\n                  @click=\"sendOTP.submit({ email, login: isLogin })\"\n                >\n                  {{ isLogin ? \"Login\" : \"Join\" }}\n                </Button>\n                <div\n                  v-if=\"oAuthProviders.data?.length\"\n                  class=\"mt-6 border-t text-center\"\n                >\n                  <div class=\"-translate-y-1/2 transform\">\n                    <span\n                      class=\"relative bg-surface-white px-2 text-sm font-medium leading-8 text-ink-gray-8\"\n                    >\n                      or\n                    </span>\n                  </div>\n                </div>\n                <Button\n                  v-for=\"provider in oAuthProviders.data\"\n                  :key=\"provider.name\"\n                  class=\"mb-2\"\n                  :loading=\"oAuth.loading\"\n                  :link=\"provider.auth_url\"\n                >\n                  <div class=\"flex items-center\">\n                    <div v-html=\"provider.icon\" />\n                    <span class=\"ml-2\">{{ isLogin ? \"Continue\" : \"Join\" }} with\n                      {{ provider.provider_name }}</span>\n                  </div>\n                </Button>\n              </template>\n            </form>\n\n            <div\n              v-if=\"!signupDisabled.data\"\n              class=\"mt-6 text-center\"\n            >\n              <router-link\n                class=\"text-center text-sm text-ink-gray-8 hover:text-ink-gray-9\"\n                :to=\"{\n                  name: isLogin ? 'Signup' : 'Login',\n                  query: { ...$route.query, forgot: undefined },\n                }\"\n              >\n                {{\n                  isLogin\n                    ? \"New member? Create a new account.\"\n                    : \"Already have an account? Log in.\"\n                }}\n              </router-link>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { createResource, ErrorMessage, FormControl, Link } from \"frappe-ui\"\nimport { ref, onMounted, computed } from \"vue\"\nimport FrappeDriveLogo from \"@/components/FrappeDriveLogo.vue\"\nimport { toast } from \"@/utils/toasts\"\nimport { useRoute } from \"vue-router\"\nimport { settings } from \"@/resources/permissions\"\n\nconst route = useRoute()\nconst params = new URLSearchParams(new URL(window.location.href).search)\nconst email = ref(params.get(\"e\") || \"\")\nconst first_name = ref(\"\")\nconst last_name = ref(\"\")\nconst terms_accepted = ref(false)\n\nconst otp = ref(\"\")\nconst otpResendCountdown = ref(0)\nconst account_request = ref(params.get(\"r\") || \"\")\nconst otpRequested = ref(account_request.value !== \"\")\nconst otpValidated = ref(account_request.value !== \"\")\nconst isLogin = computed(() => route.name === \"Login\")\n\nonMounted(() => {\n  setInterval(() => {\n    if (otpResendCountdown.value > 0) otpResendCountdown.value -= 1\n  }, 1000)\n})\n\nconst getReferrerIfAny = () => {\n  const params = location.search\n  const searchParams = new URLSearchParams(params)\n  return searchParams.get(\"referrer\")\n}\nconst signupDisabled = createResource({\n  url: \"drive.api.product.signup_disabled\",\n  cache: \"signupDisabled\",\n  auto: true,\n})\n\nconst signup = createResource({\n  url: \"drive.api.product.signup\",\n  makeParams: () => ({\n    account_request: account_request.value,\n    first_name: first_name.value,\n    last_name: last_name.value,\n    referrer: getReferrerIfAny(),\n  }),\n  validate() {\n    if (!terms_accepted.value) {\n      throw new Error(\"Please accept the terms of service\")\n    }\n  },\n  onSuccess(data) {\n    window.location.href = data.location\n  },\n  onError(err) {\n    if (err.exc_type === \"DuplicateEntryError\") {\n      toast(\"Account already exists - please login.\")\n    } else {\n      toast(\"Failed to create account\")\n    }\n  },\n})\n\nconst oAuthProviders = createResource({\n  url: \"drive.api.product.oauth_providers\",\n  auto: true,\n})\n\nconst oAuth = createResource({\n  url: \"drive.api.product.google_login\",\n  onSuccess(url) {\n    window.location.href = url\n  },\n})\n\nconst sendOTP = createResource({\n  url: \"drive.api.product.send_otp\",\n  onSuccess(data) {\n    otpRequested.value = true\n    otpResendCountdown.value = 30\n    account_request.value = data.message || data\n    toast(\"Verification code sent to your email\")\n  },\n  onError(err) {\n    if (JSON.stringify(err).includes(\"not found\"))\n      toast(\n        signupDisabled.data\n          ? \"You do not have an account on this site.\"\n          : \"Please sign up first!\"\n      )\n    else toast(\"Failed to send verification code\")\n  },\n})\n\nconst verifyOTP = createResource({\n  url: \"drive.api.product.verify_otp\",\n  onSuccess: (data) => {\n    otpValidated.value = true\n    settings.fetch()\n    if (data.location) {\n      window.location.replace(data.location)\n    }\n  },\n})\n</script>\n"],"names":["_sfc_main","_createBlock","_resolveDynamicComponent","$options","_mergeProps","_renderSlot","_ctx","route","useRoute","params","email","ref","first_name","last_name","terms_accepted","otp","otpResendCountdown","account_request","otpRequested","otpValidated","isLogin","computed","onMounted","getReferrerIfAny","signupDisabled","createResource","signup","data","err","toast","oAuthProviders","oAuth","url","sendOTP","verifyOTP","settings","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_createVNode","FrappeDriveLogo","_hoisted_6","_hoisted_7","_hoisted_8","_toDisplayString","_unref","_hoisted_9","_hoisted_10","FormControl","$event","_Fragment","_hoisted_11","_hoisted_12","_hoisted_13","Link","_cache","_hoisted_14","_component_Button","_hoisted_15","e","ErrorMessage","_createTextVNode","_hoisted_16","_renderList","provider","_hoisted_17","_hoisted_19","_hoisted_20","_component_router_link","$route"],"mappings":"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","x_google_ignoreList":[0]}