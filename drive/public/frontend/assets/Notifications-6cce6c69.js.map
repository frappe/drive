{"version":3,"file":"Notifications-6cce6c69.js","sources":["../../../../frontend/src/pages/Notifications.vue"],"sourcesContent":["<template>\n  <div\n    class=\"bg-surface-white border-b w-full px-5 py-2.5 h-12 flex items-center justify-between\"\n  >\n    <div\n      class=\"bg-surface-gray-2 rounded-[10px] space-x-0.5 h-7 flex items-center px-0.5 py-1\"\n    >\n      <TabButtons\n        v-model=\"onlyUnread\"\n        :buttons=\"[\n          {\n            label: 'Unread',\n            value: true,\n          },\n          { label: 'All', value: false },\n        ]\"\n      />\n    </div>\n    <div>\n      <Button\n        :loading=\"notifications.loading\"\n        icon=\"refresh-ccw\"\n        class=\"mr-2\"\n        @click=\"notifications.reload()\"\n      />\n      <Button\n        icon-left=\"check-circle\"\n        @click=\"markAsRead.submit({ all: true }), (store.state.notifCount = 0)\"\n      >\n        Mark all as Read\n      </Button>\n    </div>\n  </div>\n  <ListView\n    v-if=\"notifications.data?.length\"\n    class=\"px-5 pt-5\"\n    :columns=\"columns\"\n    :options=\"options\"\n    :rows=\"notifications.data\"\n    row-key=\"name\"\n  />\n  <div\n    v-else\n    class=\"flex flex-col items-center justify-center m-auto min-h-full overflow-auto\"\n    style=\"transform: translate(0, -42px)\"\n  >\n    <LucideInbox class=\"w-14 h-auto text-ink-gray-4 pb-4\" />\n    <span class=\"text-base text-ink-gray-5 font-medium\">No Notifications</span>\n  </div>\n</template>\n<script setup>\nimport { ref, h, watch } from \"vue\"\nimport { formatTimeAgo } from \"@vueuse/core\"\nimport { createResource, Avatar, ListView, TabButtons } from \"frappe-ui\"\nimport { useStore } from \"vuex\"\nimport { formatDate } from \"@/utils/format\"\nimport emitter from \"@/emitter\"\nimport LucideInbox from \"~icons/lucide/inbox\"\n\nconst store = useStore()\nconst onlyUnread = ref(true)\nconst options = {\n  getRowRoute: (row) => ({\n    name: row.entity_type,\n    params: { entityName: row.notif_doctype_name },\n  }),\n  onRowClick: (row) => {\n    if (row.type === \"Team\") emitter.emit(\"showSettings\", 1)\n    if (onlyUnread.value) {\n      markAsRead.submit({ name: row.name })\n      store.state.notifCount = store.state.notifCount - 1\n    }\n  },\n  selectable: false,\n  showTooltip: true,\n  resizeColumn: false,\n}\n\nconst columns = [\n  {\n    label: \"Subject\",\n    key: \"subject\",\n    width: \"80px\",\n    getLabel: ({ row }) => row.type,\n  },\n  {\n    label: \"Message\",\n    key: \"message\",\n    width: 4,\n    getLabel: ({ row }) => row.message,\n    prefix: ({ row }) => {\n      if (row.from_user)\n        return h(Avatar, {\n          shape: \"circle\",\n          label: row.from_user,\n          image: row.user_image,\n          size: \"sm\",\n        })\n    },\n  },\n  {\n    key: \"creation\",\n    align: \"end\",\n    getLabel: ({ row }) => row.relativeTime,\n  },\n]\n\nwatch(onlyUnread, (newValue) => {\n  notifications.fetch({\n    only_unread: newValue,\n  })\n})\n\nconst notifications = createResource({\n  url: \"drive.api.notifications.get_notifications\",\n  auto: true,\n  params: {\n    only_unread: onlyUnread.value,\n  },\n  onSuccess(data) {\n    data.forEach((item) => {\n      item.relativeTime = formatTimeAgo(new Date(item.creation))\n      item.creation = formatDate(item.creation)\n    })\n  },\n})\n\nconst markAsRead = createResource({\n  url: \"drive.api.notifications.mark_as_read\",\n  auto: false,\n  method: \"POST\",\n  params: {\n    name: \"\",\n    all: false,\n  },\n  onSuccess() {\n    notifications.reload()\n  },\n})\n</script>\n"],"names":["store","useStore","onlyUnread","ref","options","row","emitter","markAsRead","columns","h","Avatar","watch","newValue","notifications","createResource","data","item","formatTimeAgo","formatDate","_createElementVNode","_hoisted_1","_hoisted_2","_createVNode","_unref","TabButtons","$event","_component_Button","_cache","_createBlock","ListView","_openBlock","_createElementBlock","_hoisted_3","LucideInbox"],"mappings":"kkBA2DA,MAAMA,EAAQC,EAAS,EACjBC,EAAaC,EAAI,EAAI,EACrBC,EAAU,CACd,YAAcC,IAAS,CACrB,KAAMA,EAAI,YACV,OAAQ,CAAE,WAAYA,EAAI,kBAAoB,CAClD,GACE,WAAaA,GAAQ,CACfA,EAAI,OAAS,QAAQC,EAAQ,KAAK,eAAgB,CAAC,EACnDJ,EAAW,QACbK,EAAW,OAAO,CAAE,KAAMF,EAAI,IAAI,CAAE,EACpCL,EAAM,MAAM,WAAaA,EAAM,MAAM,WAAa,EAErD,EACD,WAAY,GACZ,YAAa,GACb,aAAc,EAChB,EAEMQ,EAAU,CACd,CACE,MAAO,UACP,IAAK,UACL,MAAO,OACP,SAAU,CAAC,CAAE,IAAAH,CAAK,IAAKA,EAAI,IAC5B,EACD,CACE,MAAO,UACP,IAAK,UACL,MAAO,EACP,SAAU,CAAC,CAAE,IAAAA,CAAK,IAAKA,EAAI,QAC3B,OAAQ,CAAC,CAAE,IAAAA,KAAU,CACnB,GAAIA,EAAI,UACN,OAAOI,EAAEC,EAAQ,CACf,MAAO,SACP,MAAOL,EAAI,UACX,MAAOA,EAAI,WACX,KAAM,IAChB,CAAS,CACJ,CACF,EACD,CACE,IAAK,WACL,MAAO,MACP,SAAU,CAAC,CAAE,IAAAA,CAAK,IAAKA,EAAI,YAC5B,CACH,EAEAM,EAAMT,EAAaU,GAAa,CAC9BC,EAAc,MAAM,CAClB,YAAaD,CACjB,CAAG,CACH,CAAC,EAED,MAAMC,EAAgBC,EAAe,CACnC,IAAK,4CACL,KAAM,GACN,OAAQ,CACN,YAAaZ,EAAW,KACzB,EACD,UAAUa,EAAM,CACdA,EAAK,QAASC,GAAS,CACrBA,EAAK,aAAeC,EAAc,IAAI,KAAKD,EAAK,QAAQ,CAAC,EACzDA,EAAK,SAAWE,EAAWF,EAAK,QAAQ,CAC9C,CAAK,CACF,CACH,CAAC,EAEKT,EAAaO,EAAe,CAChC,IAAK,uCACL,KAAM,GACN,OAAQ,OACR,OAAQ,CACN,KAAM,GACN,IAAK,EACN,EACD,WAAY,CACVD,EAAc,OAAO,CACtB,CACH,CAAC,yDAzICM,EA+BM,MA/BNC,EA+BM,CA5BJD,EAaM,MAbNE,EAaM,CAVJC,EASEC,EAAAC,CAAA,EAAA,YARStB,EAAU,2CAAVA,EAAU,MAAAuB,GAClB,QAAS,iDAMT,4BAGLN,EAaM,MAAA,KAAA,CAZJG,EAKEI,EAAA,CAJC,QAASH,EAAaV,CAAA,EAAC,QACxB,KAAK,cACL,MAAM,OACL,QAAKc,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAF,GAAEF,EAAaV,CAAA,EAAC,OAAM,wBAE9BS,EAKSI,EAAA,CAJP,YAAU,eACT,QAAKC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAF,IAAEF,KAAW,iBAAwBA,EAAKvB,CAAA,EAAC,MAAM,WAAU,gBAClE,IAED,CAAA,GAAA2B,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAFC,qBAED,EAAA,gBAIIJ,EAAaV,CAAA,EAAC,MAAM,YAD5Be,EAOEL,EAAAM,CAAA,EAAA,OALA,MAAM,YACL,QAASrB,EACT,QAASJ,EACT,KAAMmB,EAAaV,CAAA,EAAC,KACrB,UAAQ,2BAEViB,IAAAC,EAOM,MAPNC,EAOM,CAFJV,EAAwDC,EAAAU,CAAA,EAAA,CAA3C,MAAM,kCAAkC,CAAA,EACrDN,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAR,EAA2E,OAArE,CAAA,MAAM,uCAAuC,EAAC,mBAAgB,EAAA"}